/*
 * Copyright (c) 2024 Nordic Semiconductor ASA
 *
 * SPDX-License-Identifier: BSD-3-Clause
 */

/** @file rpu_if.h
 * @brief Common structures and definitions for RPU interface.
 */


#ifndef __RPU_IF_H__
#define __RPU_IF_H__
#include "pack_def.h"
#include "nrf71_wifi_common.h"

#ifdef DDR_32_BIT_ADDR
#define MEMORY_HOLE_BASE_ADDR 0xC0000000
#endif /* DDR_32_BIT_ADDR */

#define NRF_WIFI_UMAC_VER(version) (((version)&0xFF000000) >> 24)
#define NRF_WIFI_UMAC_VER_MAJ(version) (((version)&0x00FF0000) >> 16)
#define NRF_WIFI_UMAC_VER_MIN(version) (((version)&0x0000FF00) >> 8)
#define NRF_WIFI_UMAC_VER_EXTRA(version) (((version)&0x000000FF) >> 0)
#define RPU_MEM_UMAC_BOOT_SIG 0x20080000
#define RPU_MEM_UMAC_VER 0x20080004
#define RPU_MEM_UMAC_PEND_Q_BMP 0x20080008
#define RPU_MEM_TX_CMD_BASE 0x20080024
#define RPU_MEM_DATA_RAM_BASE 0x20085000
#define RPU_DATA_CMD_SIZE_MAX_TX 148
#define RPU_EVENT_COMMON_SIZE_MAX 128

#define NRF_WIFI_UMAC_BOOT_SIG 0x5A5A5A5A
#define NRF_WIFI_UMAC_ROM_PATCH_OFFSET (RPU_MEM_UMAC_PATCH_BIMG - RPU_ADDR_UMAC_CORE_RET_START)
#define NRF_WIFI_UMAC_BOOT_EXCP_VECT_0 0x3c1a8000
#define NRF_WIFI_UMAC_BOOT_EXCP_VECT_1 0x275a0000
#define NRF_WIFI_UMAC_BOOT_EXCP_VECT_2 0x03400008
#define NRF_WIFI_UMAC_BOOT_EXCP_VECT_3 0x00000000

/*#define RPU_DATA_RAMA_OFFSET 0x200000*/
#define RPU_ADDR_ACTUAL_DATA_RAM_START 0x20000000
#define RPU_ADDR_ACTUAL_DATA_RAM_END   0x200FFFFF
#define RPU_ADDR_DATA_RAM_START 0x20080000
#define RPU_ADDR_DATA_RAM_END   0x200E0000

#define RPU_ADDR_RAM0_ROM0_REGION 0x28000000
#define RPU_ADDR_RAM1_ROM1_REGION 0x28100000

/*#define RPU_RAM0_OFFSET 0x100000*/
#define RPU_ADDR_RAM0_REGION 0x28000000
#define RPU_ADDR_RAM0_START 0x28000000
#define RPU_ADDR_RAM0_END   0x2807FFFF

/*#define RPU_RAM1_OFFSET 0x180000*/
#define RPU_ADDR_RAM1_REGION 0x28100000
#define RPU_ADDR_RAM1_START 0x28100000
#define RPU_ADDR_RAM1_END   0x2817FFFF

/*#define RPU_ROM0_OFFSET 0x100000*/
#define RPU_ADDR_ROM0_REGION 0x28080000
#define RPU_ADDR_ROM0_START 0x28080000
#define RPU_ADDR_ROM0_END   0x280FFFFF

/*#define RPU_ROM1_OFFSET 0x180000*/
#define RPU_ADDR_ROM1_REGION 0x28180000
#define RPU_ADDR_ROM1_START 0x28180000
#define RPU_ADDR_ROM1_END   0x281FFFFF

/*#define RPU_WIFI_MCU_REGS_OFFSET 0x000000*/
#define RPU_ADDR_WIFI_MCU_REGS_REGION 0x48000000
#define RPU_ADDR_WIFI_MCU_REGS_START 0x48000000
#define RPU_ADDR_WIFI_MCU_REGS_END 0x480FFFFF

/*#define RPU_CODE_RAM_REGS_OFFSET 0x300000*/
#define RPU_ADDR_CODE_RAM_REGION 0x00200000
#define RPU_ADDR_CODE_RAM_START 0x00280000
#define RPU_ADDR_CODE_RAM_END   0x002FFFFF

/*#define RPU_SECURERAM_REGS_OFFSET 0x3e0000*/
#define RPU_ADDR_SECURERAM_REGION 0x28400000
#define RPU_ADDR_SECURERAM_START 0x28400000
#define RPU_ADDR_SECURERAM_END   0x2841FFFB

/*#define RPU_FPGA_REGS_OFFSET 0x3A0000*/
#define RPU_ADDR_FPGA_REGS_REGION 0x80000000
#define RPU_ADDR_FPGA_REGS_START 0x80000000
#define RPU_ADDR_FPGA_REGS_END   0x8000FFFF

/*#define RPU_BELLBOARD_APP_REGS_OFFSET 0x388000*/
#define RPU_ADDR_BELLBOARD_GRTC_REGION 0x40000000
#define RPU_ADDR_BELLBOARD_APP_REGION 0x40078000
#define RPU_ADDR_BELLBOARD_APP_START 0x40078000
#define RPU_ADDR_BELLBOARD_APP_END   0x40079FFF

/*#define RPU_BELLBOARD_WIFI_REGS_OFFSET 0x38C000*/
#define RPU_ADDR_BELLBOARD_WIFI_REGION 0x40074000
#define RPU_ADDR_BELLBOARD_WIFI_START 0x40074000
#define RPU_ADDR_BELLBOARD_WIFI_END   0x40075FFF


#define RPU_ADDR_GRTC_REGION 0x400E2000
#define RPU_ADDR_GRTC_START  0x400E2000
#define RPU_ADDR_GRTC_END    0x400E3FFF

#define RPU_ADDR_WICR_REGS_REGION 0x00F00000
#define RPU_ADDR_WICR_REGS_START  0x00FF0000
#define RPU_ADDR_WICR_REGS_END    0x00FFFFFF

/* Needed for calculatating sleep controller address */
#define RPU_ADDR_LMAC_CORE_RET_START 0x80040000
#define RPU_ADDR_UMAC_CORE_RET_START 0x80080000

enum RPU_MCU_ADDR_REGIONS {
	RPU_MCU_ADDR_REGION_ROM = 0,
	RPU_MCU_ADDR_REGION_RETENTION,
	RPU_MCU_ADDR_REGION_SCRATCH,
	RPU_MCU_ADDR_REGION_MAX,

};

struct rpu_addr_region {
	unsigned int start;
	unsigned int end;
};

struct rpu_addr_map {
	struct rpu_addr_region regions[RPU_MCU_ADDR_REGION_MAX];
};

static const struct rpu_addr_map RPU_ADDR_MAP_MCU[] = {
	/* MCU1 - LMAC */
	{
		{
			{0x80000000, 0x80033FFF},
			{0x80040000, 0x8004BFFF},
			{0x80080000, 0x8008FFFF}
		},
	},
	/* MCU2 - UMAC */
	{
		{
			{0x80000000, 0x800617FF},
			{0x80080000, 0x800A3FFF},
			{0x80100000, 0x80137FFF},
		}
	},
};
#define RPU_ADDR_MASK_BASE 0xFFF00000
#define RPU_ADDR_BELLBOARD_GRTC_MASK_BASE 0xFFFFF000
#define RPU_ADDR_MASK_OFFSET 0x000FFFFF
#define RPU_BELLBOARD_GRTC_ADDR_MASK_OFFSET 0x00000FFF
#define RPU_ADDR_RAM_ROM_MASK_OFFSET 0x000FFFFF
#define RPU_WICR_ADDR_MASK_OFFSET 0x0000FFFF
#define RPU_ADDR_MASK_BEV_OFFSET 0x000FFFFF
#define RPU_MEM_RX_CMD_BASE 0x28000308
#define WEZEN_RPU_REG_INT_FROM_MCU_CTRL  0x40078300
#define WEZEN_RPU_REG_INT_FROM_MCU_CLR   0x40078100
#define GRTC_CLKCFG_ADDR 0x400E2718
#define GRTC_CLKCFG_VAL 0x10001
#define GRTC_MODE_ADDR   0x400E2510
#define GRTC_MODE_VAL   0x2
#define GRTC_TASKS_START_ADDR 0x400E2060
#define GRTC_TASKS_START_VAL 0x1
#define VPR0_CPURUN_ADDR 0x48000800
#define VPR0_CPURUN_VAL 0x1
#define VPR0_INITPC_ADDR 0x48000808
#define WEZEN_RPU_REG_INT_TO_WIFICORE_BELLBOARD_TASKS_TRIGGER    0x40074008
#define RPU_REG_BIT_ROM_ACCESS_DISABLE 0
#define RPU_REG_BIT_ROM_ACCESS_ENABLE 1
#define ROM_ACCESS_REG_ADDR 0x80001048
#define RPU_REG_WICR_ADDR_ROM1_START 0x00FFB004
#define RPU_REG_WICR_ADDR_VPR0_PATCH_ADDR 0x00FFB008
#define RPU_REG_WICR_ADDR_VPR1_PATCH_ADDR 0x00FFB00C


#define RPU_CMD_START_MAGIC 0xDEAD

#define RPU_REG_BIT_HARDRST_CTRL 8

/*Event pool*/
#define EVENT_POOL_NUM_ELEMS (7)
#define MAX_EVENT_POOL_LEN 1000


#define RAM0_START_ADDR 0x28000300
#define RPU_MEM_LMAC_BOOT_SIG (RAM0_START_ADDR + 0x0)
#define RPU_MEM_LMAC_VER 0x4
#define RPU_MEM_LMAC_PATCH_BIN 0x80046000
#define RPU_MEM_LMAC_PATCH_BIMG 0x80047000

#define NRF_WIFI_LMAC_VER(ver) ((ver & 0xFF000000) >> 24)
#define NRF_WIFI_LMAC_VER_MAJ(ver) ((ver & 0x00FF0000) >> 16)
#define NRF_WIFI_LMAC_VER_MIN(ver) ((ver & 0x0000FF00) >> 8)
#define NRF_WIFI_LMAC_VER_EXTRA(ver) (ver & 0x000000FF)

#define NRF_WIFI_LMAC_BOOT_SIG 0x5A5A5A5A
#define NRF_WIFI_LMAC_ROM_PATCH_OFFSET (RPU_MEM_LMAC_PATCH_BIMG -\
										RPU_ADDR_MCU1_CORE_RET_START)
#define NRF_WIFI_LMAC_BOOT_EXCP_VECT_0 0x3c1a8000
#define NRF_WIFI_LMAC_BOOT_EXCP_VECT_1 0x275a0000
#define NRF_WIFI_LMAC_BOOT_EXCP_VECT_2 0x03400008
#define NRF_WIFI_LMAC_BOOT_EXCP_VECT_3 0x00000000
/**
 * struct host_rpu_rx_buf_info - RX buffer related information to be passed to
 *                               the RPU.
 * @addr: Address in the host memory where the RX buffer is located.
 *
 * This structure encapsulates the information to be passed to the RPU for
 * buffers which the RPU will use to pass the received frames.
 */

struct host_rpu_rx_buf_info {
	unsigned int addr;
} __NRF_WIFI_PKD;

/**
 * @brief This structure represents the bitmap of STA (Station) pending frames in
 *  SoftAP power save mode.
 *
 */

struct sap_pend_frames_bitmap {
	/** STA MAC address */
	unsigned char mac_addr[6];
	/** Pending frames bitmap for each access category */
	unsigned char pend_frames_bitmap;
} __NRF_WIFI_PKD;

/**
 * @brief This structure represents the information related to UMAC.
 *
 */
struct host_rpu_umac_if_info {
	/** Boot status signature */
	unsigned int boot_status;
	/** UMAC version */
	unsigned int version;
	/** @ref sap_pend_frames_bitmap */
	struct sap_pend_frames_bitmap sap_bitmap[NRF_WIFI_MAX_SAP_CLIENTS];
} __NRF_WIFI_PKD;

#ifdef SOFT_HPQM

#define HOST_RPU_SOFTHPQM_INFO_START 0x200844b4
#define HOST_RPU_CMD_BUFFERS 4
#define HOST_RPU_EVENT_BUFFERS 7
#define HOST_RPU_TX_DESC 12

struct soft_hpqm_info {
	volatile unsigned int host_cmd_free_index;
	volatile unsigned int rpu_cmd_busy_index;
	volatile unsigned int host_event_busy_index;
	volatile unsigned int rpu_event_free_index;
	volatile unsigned int host_tx_cmd_busy_index;
	volatile unsigned int rpu_tx_cmd_busy_index;
	volatile unsigned int host_tx_done_busy_index;
	volatile unsigned int rpu_tx_done_busy_index;
	volatile unsigned int cmd_free_buffs[HOST_RPU_CMD_BUFFERS];
	volatile unsigned int cmd_busy_buffs[HOST_RPU_CMD_BUFFERS];
	volatile unsigned int event_free_buffs[HOST_RPU_EVENT_BUFFERS];
	volatile unsigned int event_busy_buffs[HOST_RPU_EVENT_BUFFERS];
	volatile unsigned int tx_cmd_buffs[HOST_RPU_TX_DESC];
	volatile unsigned int tx_done_buffs[HOST_RPU_TX_DESC];
};

#endif /* SOFT_HPQM */



#ifdef ASICBUILD
		#define NRF_WIFI_ASICBUILD_RF_PARAMS "0000000000002A00000000030303036060606060606060600000000050EC000000000000000000000000007077003F032424001000002800323500000CF008087D8105010071630300EED501001F6F00003B350100F52E0000E35E0000B7B6000066EFFEFFB5F60000896200007A840200E28FFCFF08080808040A140100000000A1A10178000000080050003B020726181818181A120A140E0600"
#elif defined(C0_CHIP)
		#define NRF_WIFI_C0_RF_PARAMS "0000000000001C00000000000000004030303838383838380000000050EC000000000000000000000000214365003F032424001000002800323500000CF008007D8105010071630300EED501001F6F00003B350100F52E0000E35E0000B7B6000066EFFEFFB5F60000896200007A840200E28FFCFF08080808040A140100000000A1A10178000000680150003B0207262D2D28281A120A140E0600"
#else /* Simulator and Emulator */
        #define NRF_WIFI_PLAYOUT_RF_PARAMS "0000000000001C00000000000000005050505050505050500000000050EC000000000000000000000000214365003F032424001000002800323500000000080A7D8105010071630300EED501001F6F00003B350100F52E0000E35E0000B7B6000066EFFEFFB5F60000896200007A840200E28FFCFF08080808040A120100000000A1A101A0000000280050003B0207260F0F0F0F1A120A140E0600"
#endif



#endif /* __RPU_IF_H__ */
